#!/usr/bin/perl                                                                                                                                                                                                                                                
##                                                                                                                                                                                                                                                              
##   =================================================================================                                                                                                                                                                          
##       check the usage of current directory, need to be enhanced, for now                                                                                                                                                                                     
##       only support current working directory.                                                                                                                                                                                                                
##   =================================================================================                                                                                                                                                                          
##                                                                                                                                                                                                                                                              
#use Cwd;                                                                                                                                                                                                                                                       
#$hidden = 0;                                                                                                                                                                                                                                                   
#my $cwd =cwd();                                                                                                                                                                                                                                                
#opendir(my $dh, $cwd)|| die;                                                                                                                                                                                                                                   
#while ( my $node = readdir($dh) ) {                                                                                                                                                                                                                            
#  next if $node !~ /^\./;                                                                                                                                                                                                                                      
#    next if $node eq "." or $node eq "..";                                                                                                                                                                                                                       
#      $hidden = 1;                                                                                                                                                                                                                                                 
#        last;                                                                                                                                                                                                                                                        
#        }                                                                                                                                                                                                                                                              
#        ### from internet, but buggy if two directory has the same disk usage. TODO understand it                                                                                                                                                                      
#        #%h=map{/.\s/;99**(ord$&&7)-$`,$_}`/usr/bin/du -hs * .[!.]*`;die@h{sort%h}                                                                                                                                                                                     
#                                                                                                                                                                                                                                                                       
#                                                                                                                                                                                                                                                                       my $cmd;                                                                                                                                                                                                                                                       
#                                                                                                                                                                                                                                                                       # cannot use ~/mydu.txt, ~is for shell(bash) but not for perl                                                                                                                                                                                                  
#                                                                                                                                                                                                                                                                       my $tmpFile = $ENV{"HOME"}."/mydu.txt"; #some directory has no permission to write                                                                                                                                                                             
#                                                                                                                                                                                                                                                                       my $tFile = $tmpFile;                                                                                                                                                                                                                                          
#                                                                                                                                                                                                                                                                       my $index = 0;                                                                                                                                                                                                                                                 
#                                                                                                                                                                                                                                                                       while(-e $tmpFile){                                                                                                                                                                                                                                            
#                                                                                                                                                                                                                                                                           ++$index;                                                                                                                                                                                                                                                  
#                                                                                                                                                                                                                                                                               $tmpFile = $tFile+'.'+$index;                                                                                                                                                                                                                              
#                                                                                                                                                                                                                                                                               }                                                                                                                                                                                                                                                              
#                                                                                                                                                                                                                                                                               if($hidden){                                                                                                                                                                                                                                                   
#                                                                                                                                                                                                                                                                                   $cmd = "/usr/bin/du -chs --exclude=.snapshot * .[!.]* > $tmpFile";                                                                                                                                                                                         
#                                                                                                                                                                                                                                                                                   }else{                                                                                                                                                                                                                                                         
#                                                                                                                                                                                                                                                                                       $cmd = "/usr/bin/du -chs --exclude=.snapshot * > $tmpFile";                                                                                                                                                                                                
#                                                                                                                                                                                                                                                                                       }                                                                                                                                                                                                                                                              
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      system($cmd);                                                                                                                                                                                                                                                  
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     open my $fh, '<', $tmpFile;                                                                                                                                                                                                                                    
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     chomp(my @lines = <$fh>);                                                                                                                                                                                                                                      
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     # sort needs to return value of {-1, 0, 1}                                                                                                                                                                                                                     
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     my @new = sort mixed_sort @lines;                                                                                                                                                                                                                              
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     # from small to huge, no screen scroll needed                                                                                                                                                                                                                  
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     @new = reverse(@new);                                                                                                                                                                                                                                          
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     print join("\n", @new), "\n";                                                                                                                                                                                                                                  
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     unlink $tmpFile;                                                                                                                                                                                                                                               
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    sub mixed_sort {                                                                                                                                                                                                                                               
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        my @va = split(' ', $a);                                                                                                                                                                                                                                   
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            my @vb = split(' ', $b);                                                                                                                                                                                                                                   
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                my $sizeA = convert_n($va[0]);                                                                                                                                                                                                                                 my $sizeB = convert_n($vb[0]);                                                                                                                                                                                                                             
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    $status = ($sizeB <=> $sizeA) or (($va[0] eq $vb[0]) and ($vb[1] cmp $va[1]));                                                                                                                                                                             
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        #print "$va[0] $vb[0] $va[1] $vb[1] $status\n";                                                                                                                                                                                                            
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }                                                                                                                                                                                                                                                              
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       sub convert_n($va) {                                                                                                                                                                                                                                           
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           my ($va) = @_;                                                                                                                                                                                                                                             
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               my $sa = substr $va, -1, 1;                                                                                                                                                                                                                                
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   if($sa eq 'T'){                                                                                                                                                                                                                                            
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           $sizeA = substr($va, 0, length($va)-1);                                                                                                                                                                                                                
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   $sizeA *= 1e12;                                                                                                                                                                                                                                        
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       }elsif($sa eq 'G'){                                                                                                                                                                                                                                        
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               $sizeA = substr($va, 0, length($va)-1);                                                                                                                                                                                                                        $sizeA *= 1e9;                                                                                                                                                                                                                                         
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   }elsif($sa eq 'M'){                                                                                                                                                                                                                                        
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           $sizeA = substr($va, 0, length($va)-1);                                                                                                                                                                                                                
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   $sizeA *= 1e6;                                                                                                                                                                                                                                         
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       }elsif($sa eq 'K'){                                                                                                                                                                                                                                        
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               $sizeA = substr($va, 0, length($va)-1);                                                                                                                                                                                                                        $sizeA *= 1e3;                                                                                                                                                                                                                                         
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                NORMAL  du.pl                                                                                                                                                                                                         perl  utf-8[unix]    1%    1:  1  
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 })}}`}
